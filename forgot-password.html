<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Reset your password - STIF">
    <title>Forgot Password | STIF - Sustainability Technology and Innovation Forum</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    
    <style>
        .auth-page {
            min-height: calc(100vh - 70px);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: calc(70px + var(--space-8)) var(--space-6) var(--space-8);
            background: linear-gradient(135deg, var(--primary-50) 0%, white 50%, var(--gray-50) 100%);
        }
        .auth-card {
            width: 100%;
            max-width: 440px;
            background: white;
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-xl);
            padding: var(--space-10);
        }
        .auth-header {
            text-align: center;
            margin-bottom: var(--space-8);
        }
        .auth-icon {
            width: 64px;
            height: 64px;
            background: var(--primary-100);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto var(--space-4);
            color: var(--primary);
        }
        .auth-title {
            font-size: var(--text-2xl);
            margin-bottom: var(--space-2);
        }
        .auth-subtitle {
            color: var(--gray-500);
            font-size: var(--text-sm);
        }
        .auth-footer {
            text-align: center;
            margin-top: var(--space-6);
        }
        .auth-footer p {
            color: var(--gray-500);
            font-size: var(--text-sm);
        }
        .success-message {
            background: var(--success-100);
            border: 1px solid var(--success);
            border-radius: var(--radius-lg);
            padding: var(--space-4);
            margin-bottom: var(--space-4);
            color: var(--success);
            text-align: center;
        }
        .success-message svg {
            display: block;
            margin: 0 auto var(--space-3);
        }
        .error-message {
            background: var(--error-100);
            border: 1px solid var(--error);
            border-radius: var(--radius-lg);
            padding: var(--space-3) var(--space-4);
            margin-bottom: var(--space-4);
            color: var(--error);
            font-size: var(--text-sm);
        }
        .hidden { display: none !important; }
    </style>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-inner">
            <a href="/" class="logo">
                <img src="assets/images/logo1.png" alt="STIF Logo" class="logo-img">
                <span class="logo-text">Sustainability Technology and Innovation Forum</span>
            </a>
            <nav>
                <ul class="nav-menu">
                    <li><a href="/" class="nav-link">Home</a></li>
                    <li><a href="/about.html" class="nav-link">About</a></li>
                    <li><a href="/faq.html" class="nav-link">FAQ</a></li>
                </ul>
            </nav>
            <div class="nav-actions">
                <a href="/champion-login.html" class="btn btn-ghost">Login</a>
                <a href="/champion-register.html" class="btn btn-primary">Get Started</a>
            </div>
            <button class="mobile-menu-toggle" aria-label="Toggle menu">
                <span></span><span></span><span></span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu">
        <button class="mobile-menu-close">&times;</button>
        <ul class="mobile-nav-menu">
            <li><a href="/" class="mobile-nav-link">Home</a></li>
            <li><a href="/about.html" class="mobile-nav-link">About</a></li>
            <li><a href="/faq.html" class="mobile-nav-link">FAQ</a></li>
            <li><a href="/champion-login.html" class="mobile-nav-link">Login</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <main class="auth-page">
        <div class="auth-card">
            <!-- Request Form View -->
            <div id="request-view">
                <div class="auth-header">
                    <div class="auth-icon">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                        </svg>
                    </div>
                    <h1 class="auth-title">Forgot Password?</h1>
                    <p class="auth-subtitle">Enter your email address and we'll send you a link to reset your password.</p>
                </div>

                <div id="error-message" class="error-message hidden"></div>

                <form id="forgot-form">
                    <div class="form-group">
                        <label class="form-label" for="email">Email Address</label>
                        <input type="email" id="email" name="email" class="form-input" placeholder="you@company.com" required autocomplete="email">
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-full" id="submit-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                            <polyline points="22,6 12,13 2,6"></polyline>
                        </svg>
                        Send Reset Link
                    </button>
                </form>

                <div class="auth-footer">
                    <p>Remember your password? <a href="/champion-login.html">Sign In</a></p>
                    <p style="margin-top: var(--space-2);">Business user? <a href="/business-login.html">Business Login</a></p>
                </div>
            </div>

            <!-- Success View -->
            <div id="success-view" class="hidden">
                <div class="success-message">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                        <polyline points="22 4 12 14.01 9 11.01"></polyline>
                    </svg>
                    <h3 style="margin-bottom: var(--space-2); color: var(--success);">Check Your Email</h3>
                    <p>We've sent a password reset link to <strong id="sent-email"></strong></p>
                </div>
                
                <p class="text-secondary text-center mb-4" style="font-size: var(--text-sm);">
                    Didn't receive the email? Check your spam folder or try again.
                </p>
                
                <button type="button" class="btn btn-secondary w-full mb-4" id="resend-btn">
                    Resend Email
                </button>
                
                <div class="auth-footer" style="border-top: none; padding-top: 0;">
                    <p><a href="/champion-login.html">Back to Login</a></p>
                </div>
            </div>
        </div>
    </main>

    <script src="supabase-service.js"></script>
    <script src="mobile-menu.js"></script>
    <script>
        let lastEmail = '';

        document.getElementById('forgot-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            await sendResetEmail();
        });

        document.getElementById('resend-btn').addEventListener('click', async function() {
            await sendResetEmail();
        });

        async function sendResetEmail() {
            const submitBtn = document.getElementById('submit-btn');
            const resendBtn = document.getElementById('resend-btn');
            const errorEl = document.getElementById('error-message');
            const emailInput = document.getElementById('email');
            
            const email = emailInput?.value?.trim().toLowerCase() || lastEmail;
            if (!email) {
                showError('Please enter your email address.');
                return;
            }
            
            lastEmail = email;
            
            // Disable buttons
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<span class="loading-spinner-sm"></span> Sending...';
            }
            if (resendBtn) {
                resendBtn.disabled = true;
                resendBtn.innerHTML = '<span class="loading-spinner-sm"></span> Sending...';
            }
            errorEl.classList.add('hidden');
            
            try {
                const supabase = window.getSupabase();
                const { error } = await supabase.auth.resetPasswordForEmail(email, {
                    redirectTo: window.location.origin + '/reset-password.html'
                });
                
                if (error) throw error;
                
                // Show success view
                document.getElementById('request-view').classList.add('hidden');
                document.getElementById('success-view').classList.remove('hidden');
                document.getElementById('sent-email').textContent = email;
                
            } catch (error) {
                console.error('Reset password error:', error);
                showError(error.message || 'Failed to send reset email. Please try again.');
            } finally {
                if (submitBtn) {
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg> Send Reset Link`;
                }
                if (resendBtn) {
                    resendBtn.disabled = false;
                    resendBtn.textContent = 'Resend Email';
                }
            }
        }

        function showError(message) {
            const errorEl = document.getElementById('error-message');
            errorEl.textContent = message;
            errorEl.classList.remove('hidden');
        }
    </script>
</body>
</html>
