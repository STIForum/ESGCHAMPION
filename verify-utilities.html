<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Verification</title>
    <style>
        body { font-family: system-ui, sans-serif; padding: 2rem; max-width: 800px; margin: 0 auto; }
        .test { padding: 0.5rem 1rem; margin: 0.25rem 0; border-radius: 4px; }
        .pass { background: #d4edda; color: #155724; }
        .fail { background: #f8d7da; color: #721c24; }
        h1 { color: #333; }
        h2 { color: #666; margin-top: 1.5rem; }
        .summary { padding: 1rem; margin-top: 1rem; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>
    <h1>ESG Champions - Utility Verification</h1>
    <div id="results"></div>
    <div id="summary" class="summary"></div>

    <!-- Load supabase config first (needed for env.js) -->
    <script src="supabase-config.js"></script>
    
    <!-- Load utilities in the same order as HTML pages -->
    <script src="src/core/env.js"></script>
    <script src="src/core/config.js"></script>
    <script src="src/core/router-helpers.js"></script>
    <script src="src/lib/supabase/client.js"></script>
    <script src="src/lib/supabase/errors.js"></script>
    <script src="src/ui/toast.js"></script>
    <script src="src/ui/loading.js"></script>
    <script src="src/ui/form.js"></script>
    <script src="src/utils/format.js"></script>
    <script src="src/utils/dom.js"></script>

    <script>
        const results = document.getElementById('results');
        const summary = document.getElementById('summary');
        let passed = 0;
        let failed = 0;

        function test(name, condition) {
            const div = document.createElement('div');
            div.className = 'test ' + (condition ? 'pass' : 'fail');
            div.textContent = (condition ? '✓ ' : '✗ ') + name;
            results.appendChild(div);
            if (condition) passed++; else failed++;
        }

        function section(name) {
            const h2 = document.createElement('h2');
            h2.textContent = name;
            results.appendChild(h2);
        }

        // Core utilities
        section('Core Utilities');
        test('CONFIG exists', typeof window.CONFIG !== 'undefined');
        test('CONFIG.ROUTES exists', typeof window.CONFIG?.ROUTES !== 'undefined');
        test('getQueryParam exists', typeof window.getQueryParam === 'function');
        test('navigateTo exists', typeof window.navigateTo === 'function');
        test('redirectToLogin exists', typeof window.redirectToLogin === 'function');

        // Supabase utilities
        section('Supabase Utilities');
        test('getSupabaseClient exists', typeof window.getSupabaseClient === 'function');
        test('fromTable exists', typeof window.fromTable === 'function');
        test('getAuth exists', typeof window.getAuth === 'function');
        test('normalizeError exists', typeof window.normalizeError === 'function');
        test('handleError exists', typeof window.handleError === 'function');

        // UI utilities
        section('UI Utilities');
        test('showToast exists', typeof window.showToast === 'function');
        test('showSuccess exists', typeof window.showSuccess === 'function');
        test('showError exists', typeof window.showError === 'function');
        test('showLoading exists', typeof window.showLoading === 'function');
        test('hideLoading exists', typeof window.hideLoading === 'function');
        test('showErrorState exists', typeof window.showErrorState === 'function');
        test('showEmptyState exists', typeof window.showEmptyState === 'function');

        // Form utilities
        section('Form Utilities');
        test('getFormValues exists', typeof window.getFormValues === 'function');
        test('setFormValues exists', typeof window.setFormValues === 'function');
        test('buildSafePayload exists', typeof window.buildSafePayload === 'function');
        test('onFormSubmit exists', typeof window.onFormSubmit === 'function');

        // Format utilities
        section('Format Utilities');
        test('formatDate exists', typeof window.formatDate === 'function');
        test('formatRelativeTime exists', typeof window.formatRelativeTime === 'function');
        test('formatNumber exists', typeof window.formatNumber === 'function');
        test('getInitials exists', typeof window.getInitials === 'function');
        test('truncateText exists', typeof window.truncateText === 'function');

        // DOM utilities
        section('DOM Utilities');
        test('$ exists', typeof window.$ === 'function');
        test('$q exists', typeof window.$q === 'function');
        test('$qa exists', typeof window.$qa === 'function');
        test('showElement exists', typeof window.showElement === 'function');
        test('hideElement exists', typeof window.hideElement === 'function');
        test('requireAuth exists', typeof window.requireAuth === 'function');
        test('requireAdmin exists', typeof window.requireAdmin === 'function');
        test('debounce exists', typeof window.debounce === 'function');

        // Function tests
        section('Function Behavior Tests');
        test('formatDate returns string', typeof window.formatDate(new Date()) === 'string');
        test('formatRelativeTime returns string', typeof window.formatRelativeTime(new Date()) === 'string');
        test('formatNumber handles numbers', window.formatNumber(1234567) === '1,234,567');
        test('getInitials works', window.getInitials('John Doe') === 'JD');
        test('truncateText truncates', window.truncateText('Hello World', 8) === 'Hello...');
        test('buildSafePayload filters keys', 
            Object.keys(window.buildSafePayload({a: 1, b: 2, c: 3}, ['a', 'c'])).length === 2);

        // Summary
        summary.className = 'summary ' + (failed === 0 ? 'pass' : 'fail');
        summary.textContent = `${passed} passed, ${failed} failed out of ${passed + failed} tests`;
    </script>
</body>
</html>
